!function(a,b,c){"use strict";var d=function(a){this.MESSAGES={tip1:"错误：未设置searchCallback搜索回调方法。"},this.OPTIONS=b.extend({version:"1.0.0",optionIndex:-1,dataPath:{get:"/aj_search/suggest",post:"/aj_search/suggest"},offset:function(a){var b=a.element,c=b.height(),d=b.offset(),e=d.left,f=d.top+c;return{left:e,top:f}}(a),delayTime:a.delayTime||500,selectStatus:null,position:a.position||{top:2},areaId:a.areaId||""},a),this.utils={replaceData:function(a,b){return a.replace(/(\{(.*?)\})/g,function(a,c,d){return"null"==b[d]?"":b[d]})},isEmpty:function(a){return/^\s*$/g.test(a)}}};return d.fn=d.prototype,d.fn.searchListenerEvent=function(){var a=this,c=function(c){var d=b(this),e=a.OPTIONS.defaultData,f=b.trim(d.val());return d.removeAttr("data-id"),a.utils.isEmpty(f)&&"object"==typeof e?(a.createOptionElements(a.OPTIONS.defaultData),void a.keydownSelectListener(c)):(a.buiderOptionLayer.call(this,a),void a.keydownSelectListener(c))};return a.OPTIONS.element.bind("keydown",c).bind("focus",c),a},d.fn.optionSelectEvent=function(){var a=this,c=function(){var a=b(".mrco-search-option").removeClass("selected");a.find(".mrco-search-option-delete").hide(),a.find(".mrco-search-font-history").show()};return b(".mrco-search-option").bind("click",function(c){var d=b(this),e=d.attr("data-id"),f=a.OPTIONS.defaultData.historyList;if("mrco-search-option-delete"==b(c.target).attr("class")){"function"==typeof a.OPTIONS.deleteCallback&&a.OPTIONS.deleteCallback({id:e||"-1",key:d.attr("data-name")||""});for(var g=0,h=f.length;h>g;g++)f[g]&&f[g].id==e&&delete f[g];d.remove()}else a.OPTIONS.element.val(d.attr("data-name")).attr("data-id",d.attr("data-id")).attr("data-url",d.attr("data-url")),a.closeOptionLayer(),b("#"+a.OPTIONS.buttonSearchID).click()}).bind("mouseover",function(){var d=b(this);a.OPTIONS.optionIndex=-1,c(),d.children(".hig").size()<1||(d.find(".mrco-search-font-history").hide(),d.find(".mrco-search-option-delete").show())}).bind("mouseout",function(){var a=b(this);a.children(".hig").size()<1||(a.find(".mrco-search-font-history").show(),a.find(".mrco-search-option-delete").hide())}),a},d.fn.buttonSearchClickEvent=function(){var a=this;return b("#"+a.OPTIONS.buttonSearchID).bind("click",function(){if("function"!=typeof a.OPTIONS.searchCallback)throw new Error(a.MESSAGES.tip1);a.OPTIONS.searchCallback({id:a.OPTIONS.element.attr("data-id")||"-1",key:b.trim(a.OPTIONS.element.val()),url:a.OPTIONS.element.attr("data-url")}),a.closeOptionLayer()}),a},d.fn.optionLayerHoverEvent=function(){var a;b("#js-mrco-search-wrap").hover(function(){clearTimeout(a)},function(){var c=b(this);a=setTimeout(function(){c.hide()},600)})},d.fn.keydownSelectListener=function(a){var c=b(".mrco-search-option"),d=c.size(),e=this.OPTIONS.optionIndex,f=function(a){if(!(0>a)){var b=c.removeClass("selected").eq(a);b.addClass("selected"),b.children(".hig").size()<1||(b.find(".mrco-search-font-history").hide(),b.find(".mrco-search-option-delete").show())}};return 38==a.keyCode&&e>0&&e--,40==a.keyCode&&d-1>e&&e++,13==a.keyCode?void(this.OPTIONS.optionIndex<0?b("#"+this.OPTIONS.buttonSearchID).click():b(".mrco-search-option").eq(e).click()):void f(this.OPTIONS.optionIndex=e)},d.fn.pageMouseDownListener=function(){var a=this;return b(window.document).bind("click",function(c){var d=b("#js-mrco-search-wrap:visible");try{d.size()>0&&"js-search-txt"!=c.target.id&&a.closeOptionLayer()}catch(e){return a}}),a},d.fn.createOptionElements=function(a){var c=this,d=(c.OPTIONS.offset,a.historyList||[]),e=a.keyList||[],f=b("#js-mrco-search-wrap"),g='<p class="mrco-search-option" data-id="{id}" data-name="{carName}" data-url="{url}"><a class="mrco-search-key"><span class="mrco-search-font-content">{carName}</span><span class="mrco-search-font-discount">{discount}</span><span class="mrco-search-option-delete">删除</span></a></p>',h='<p class="mrco-search-option" data-id="{id}" data-name="{carName}" data-url="{url}"><a class="mrco-search-key hig"><span class="mrco-search-font-content">{carName}</span><span class="mrco-search-font-history">{discount}</span><span class="mrco-search-option-delete">删除</span></a></p>',i='<div id="js-mrco-search-wrap" class="mrco-search-list-wrap" {style}>           <div class="mrco-search-data-layer">                                            {keyList}                                                                </div>                                                                  </div>',j="";if(d.length<1&&e.length<1)return c.closeOptionLayer();for(var k=0,l=d.length;l>k;k++)d[k]&&(j+=c.utils.replaceData(h,d[k]));for(var k=0,l=e.length;l>k;k++)j+=c.utils.replaceData(g,e[k]);f.size()>0?(f.children(".mrco-search-data-layer").html(j),f.show()):(i=c.utils.replaceData(i,{style:c.utils.replaceData('style="left:{left}px; top:{top}px; width:{width}px;"',{left:c.OPTIONS.element.position().left,top:c.OPTIONS.element.height()+c.OPTIONS.position.top,width:c.OPTIONS.element.width()-2}),keyList:j}),c.OPTIONS.element.after(i)),c.optionSelectEvent()},d.fn.buiderOptionLayer=function(a){var c=a,d=b.trim(b(this).val());c.getData(d,c.createOptionElements)},d.fn.closeOptionLayer=function(){return b("#js-mrco-search-wrap").hide(),this.OPTIONS.optionIndex=-1,this},d.fn.getData=function(a,c){var d=this;d.OPTIONS.selectStatus&&clearTimeout(d.OPTIONS.selectStatus),d.OPTIONS.selectStatus=setTimeout(function(){var e={historyList:[],keyList:[]};b.get(d.OPTIONS.dataPath.get,{query:a,areaid:d.OPTIONS.areaId},function(a){if(a&&0==a.code)for(var b=a.content,f=0;f<b.length;f++){var g=b[f],h=g.id||f,i=mclib.htmlSpecialChars(g.name)||"",j=parseFloat(g.discount);isNaN(j)&&(j=0),j=j>9.5||0>=j?"":j.toFixed(1)+"折起";var k=g.url||"",l={id:h,carName:i,discount:j,url:k};1==g.history?e.historyList.push(l):e.keyList.push(l)}c.call(d,e)}),b(document).ajaxError(function(a){c.call(d,e)})},d.OPTIONS.delayTime)},d.fn.postData=function(a,c){var d=this;b.post(d.OPTIONS.dataPath.post,{key:a},c)},d.fn.init=function(){this.searchListenerEvent().buttonSearchClickEvent().pageMouseDownListener()},b.search?void new Error("错误：检测到jQuery运行环境中已存在一个名为Search的对象。"):void(b.fn.search=function(a){new d(b.extend({element:this,buttonSearchID:a.buttonSearchID||null},a)).init()})}(window,jQuery);