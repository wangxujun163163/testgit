function onDOMReady(){initHeaderRecomBrandBannerWrap(),initBrandColumn(),initBrandContent(),initSeries(),initSidePanel(),initTopBar(),initMenu(),initHeaderDaily(),initCountDownTime(),initSearchBox(),initJSPagination()}function initHeaderRecomBrandBannerWrap(){var a=$("#recom_brand_banner_wrap");if(!a.hasClass("showfixed")){var b=$("#nav_tab_recom_brand_banner");b.hover(function(){a.addClass("bytab")},function(){a.removeClass("bytab")}),a.hover(function(){a.addClass("byself")},function(){a.removeClass("byself")})}}function initBrandColumn(){var a=$("#more_brand_in_column2");if(a.length){var b=$("#recom_brand_ul_column2");a.hover(function(){b.addClass("bymore")},function(){b.removeClass("bymore")}),b.hover(function(){b.addClass("byself")},function(){b.removeClass("byself")})}}function initBrandContent(){$("#brand_recommend_wrap").show(),$("#brand_alpha_wrap").hide(),$("#brand_index span").on("click",onBrandIndexClick),$("#brand_recommend_wrap ul li").on("click",onBrandItemClick),$("#brand_alpha_wrap span.name").on("click",onBrandItemClick);var a=$("#brand_alpha_scrollbar");a.tinyscrollbar(),brandAlphaScrollbar=a.data("plugin_tinyscrollbar"),a.bind("move",onBrandAlphaScrollbarScroll)}function onBrandIndexClick(a){var b=$(this);if(!b.hasClass("selected")){$("#brand_index span").removeClass("selected"),b.addClass("selected");var c=b.attr("content"),d=$("#brand_recommend_wrap"),e=$("#brand_alpha_wrap");if("brand_recommend"==c)d.show(),e.hide();else if("brand_alpha"==c){e.is(":hidden")&&(d.hide(),e.show(),brandAlphaScrollbar.update());var f="#item_key_"+b.text().substr(0,1).toUpperCase(),g=$(f).offset().top-$("#brand_alpha_scrollbar .overview").offset().top+1,h=brandAlphaScrollbar.contentSize-brandAlphaScrollbar.viewportSize;g=Math.max(0,Math.min(g,h)),brandAlphaScrollbar.update(g)}}}function onBrandAlphaScrollbarScroll(){var a=Number.MAX_VALUE,b="",c=$("#brand_alpha_scrollbar .overview").offset().top+brandAlphaScrollbar.contentPosition;$("#brand_alpha_wrap .alpha_item").each(function(d,e){var f=$(e).offset().top-c,g=Math.abs(f);a>g&&(a=g,b=$(e).attr("id"))});var d=b.match(/[A-Z]/);if(d){var e=new RegExp(d[0]);$("#brand_index span").removeClass("selected"),$("#brand_index span").each(function(a,b){return $(b).text().match(e)?($(b).addClass("selected"),!1):void 0})}}function onBrandItemLogoNameClick(a){var b=$(this),c=b.parent("li"),d=(c.attr("brandid"),c.attr("url"));return window.open(d),a.stopPropagation(),a.preventDefault(),a.stopImmediatePropagation(),!1}function onBrandItemClick(a){var b=$(this),c=(b.attr("brandid"),b.attr("url"));return window.open(c),a.stopPropagation(),a.preventDefault(),a.stopImmediatePropagation(),!1}function onBrandItemClickX(a){var b=$(this);if(b.hasClass("selected"))onSeriesCloseClick(),$("#recom_brand_banner_wrap").addClass("byself");else{var c=b.parents(".brand_content"),d="ul2",e=c.attr("id");if("brand_recommend_wrap"==e){var f=b.closest("ul");d=f.hasClass("column1")?"ul1":"ul2"}var g=$("#series_wrap");resetBrandItem(),b.addClass("selected");var h=b.attr("brandid");h&&(g.attr("source",d),getSeriesByBrandId(h));var i=$(".brand_wrap").offset().top-2;$("html, body").animate({scrollTop:i},500)}}function resetBrandItem(){$("#brand_recommend_wrap li.selected").removeClass("selected"),$("#brand_alpha_wrap span.name.selected").removeClass("selected")}function getSeriesByBrandId(a){$.ajax({url:"/aj_auto/chosenSeries",data:{brand:a,areaid:epath_area.id},dataType:"json",type:"post",success:function(a){a&&0==a.code?updateSeries(a.content):updateSeries()},error:function(a){updateSeries()}})}function initSeries(){$("#series_wrap").hide(),$("#series_wrap #series_close").on("click",onSeriesCloseClick);var a=$("#series_scrollbar");a.tinyscrollbar(),seriesScrollbar=a.data("plugin_tinyscrollbar")}function onSeriesCloseClick(a){closeSeries(),resetBrandItem()}function updateSeries(a){changeSeriesWrapLeftWidth(),clearSeries(),fillSeries(a),showSeries()}function showSeries(){$("#series_wrap").show(),seriesScrollbar.update()}function closeSeries(){var a=$("#series_wrap");a.attr("source","").removeAttr("source").hide(),$("#recom_brand_ul_column2").removeClass("byseries"),$("#recom_brand_banner_wrap").removeClass("byself"),$("#recom_brand_banner_wrap").removeClass("byseries")}function fillSeries(a){var b=$("#series_scrollbar > .viewport > .overview");if(!a){var c='<div class="series_header">';return c+='<span class="name">该品牌暂无车系</span>',c+='<span class="slogan">请查看其他品牌</span>',c+="</div>",void b.html(c)}var d='<div class="series_header">';d+='<img class="logo" src="'+a.brand.logo+'" />',d+='<span class="name">'+(a.brand.name||"")+"</span>",d+='<span class="slogan">'+(a.brand.slogan||"")+"</span>",d+="</div>";var e="";$.each(a.manus,function(a,b){e+='<div class="manu_item beforeafter">',e+='<p class="manu">'+b.name+"</p>",$.each(b.series,function(a,b){e+='<a href="'+b.url+'" target="_blank" stat="is_recom_brand_series">',e+='<div class="series_item">',e+='<img src="'+(b.logo?mclib.imgResize(b.logo,3):"/img/series_def_logo.jpg")+'" />',e+='<span class="name">'+b.name+"</span>",Number(b.discount)>0&&Number(b.discount)<=9.5&&(e+='<span class="discount">'+Number(b.discount).toFixed(1)+"折起</span>"),0!=Number(b.is_hot)&&(e+='<span class="hot">热</span>'),e+="</div>",e+="</a>"}),e+="</div>"}),b.append($(d+e)),initActionStat()}function clearSeries(){$("#series_scrollbar > .viewport > .overview").html("")}function changeSeriesWrapLeftWidth(){var a=$("#series_wrap"),b=!1,c=!1,d=$("#recom_brand_ul_column2");if(0==d.length)b=!0;else if(d.hasClass("showfixed"))b=!1;else{var e=a.attr("source");if("ul2"==e)b=!1,c=!0;else{var f=d.is(":hidden");f?b=!0:(b=!1,c=!0)}}b?a.addClass("column1"):a.removeClass("column1"),c?d.addClass("byseries"):d.removeClass("byseries"),$("#recom_brand_banner_wrap").addClass("byseries")}function initSidePanel(){var a={backtop:showBackTop},b=$("body").sidePanel;b&&"undefined"!=typeof b&&b instanceof Function&&(sidepanel=$("body").sidePanel(a))}function showBackTop(a,b){$("html,body").animate({scrollTop:0},500)}function showOnsalenotifysubmit(a,b,c){if(a){masklayer=$("body").masklayer(),masklayer.masklayer("show");var d={spec:a,pkg:a,areaid:epath_area.id,close:onOnsalenotifysubmitClose,complete:onOnsalenotifysubmitComplete};onsalenotifysubmit=$("body").onsalenotifysubmit(d),onsalenotifysubmit.succ=b,onsalenotifysubmit.fail=c}}function onOnsalenotifysubmitClose(a,b){var c=null;onsalenotifysubmit&&(onsalenotifysubmit.onsalenotifysubmit("destroy"),onsalenotifysubmit.fail&&(c=onsalenotifysubmit.fail),onsalenotifysubmit.succ=null,onsalenotifysubmit.fail=null,onsalenotifysubmit=null),masklayer&&masklayer.masklayer("destroy"),c&&c()}function onOnsalenotifysubmitComplete(a,b){var c=null;onsalenotifysubmit&&onsalenotifysubmit.succ&&(c=onsalenotifysubmit.succ,onsalenotifysubmit.succ=null,onsalenotifysubmit.fail=null),onOnsalenotifysubmitClose(),c&&c(b)}function showOnsalenotifycancel(a,b,c){if(a){masklayer=$("body").masklayer(),masklayer.masklayer("show");var d={id:a,close:onOnsalenotifycancelClose,complete:onOnsalenotifycancelComplete};onsalenotifycancel=$("body").onsalenotifycancel(d),onsalenotifycancel.succ=b,onsalenotifycancel.fail=c}}function onOnsalenotifycancelClose(a,b){var c=null;onsalenotifycancel&&(onsalenotifycancel.onsalenotifycancel("destroy"),onsalenotifycancel.fail&&(c=onsalenotifycancel.fail),onsalenotifycancel.succ=null,onsalenotifycancel.fail=null,onsalenotifycancel=null),masklayer&&masklayer.masklayer("destroy"),c&&c()}function onOnsalenotifycancelComplete(a,b){var c=null;onsalenotifycancel&&onsalenotifycancel.succ&&(c=onsalenotifycancel.succ,onsalenotifycancel.succ=null,onsalenotifycancel.fail=null),onOnsalenotifycancelClose(),c&&c(b)}function showModalLogin(a,b,c,d){masklayer=$("body").masklayer(),masklayer.masklayer("show");var e={modaltitle:b,extmobile:c,type:d?d:c?"code":"pw",close:onModalLoginClose,succ:onModalLoginSucc};modallogin=$("body").modallogin(e),modallogin.succ=a,sendStat("click","is_login")}function onModalLoginClose(a,b){modallogin&&(modallogin.modallogin("destroy"),modallogin.succ=null),masklayer&&masklayer.masklayer("destroy")}function onModalLoginSucc(a,b){var c=null;if(modallogin){modallogin.modallogin("destroy");var d=b.content;updateTopBarUser(d),c=modallogin.succ}masklayer&&masklayer.masklayer("destroy"),c&&"undefined"!=typeof c&&c instanceof Function&&c()}function showDialog(a,b,c,d,e,f,g,h){masklayer=$("body").masklayer(),masklayer.masklayer("show");var i={modal:a||0,title1:b||"",title2:c||"",info:d||"",ok:e||"确定",okcallback:f||null,cancel:g||"取消",cancelcallback:h||null,close:onDialogClose,complete:onDialogComplete};dialog=$("body").dialog(i),dialog.ok=f,dialog.cancel=h}function onDialogClose(a,b){dialog&&(dialog.cancel&&dialog.cancel(),dialog.dialog("destroy"),dialog.ok=null,dialog.cancel=null),masklayer&&masklayer.masklayer("destroy")}function onDialogComplete(a,b){dialog&&(dialog.ok&&dialog.ok(),dialog.dialog("destroy"),dialog.ok=null,dialog.cancel=null),masklayer&&masklayer.masklayer("destroy")}function initTopBar(){$("#user_addfav").unbind("click",onAddFav),$("#user_login").unbind("click",onUserLogin),$("#user_logout").unbind("click",onUserLogout),$("#user_addfav").bind("click",onAddFav),$("#user_login").bind("click",onUserLogin),$("#user_logout").bind("click",onUserLogout)}function onAddFav(a){var b=document.domain,c="村长团车",d="请使用Ctrl+D或Cmd+D快捷键收藏村长团车";try{document.all?window.external.addFavorite(b,c):window.sidebar?window.sidebar.addPanel(c,b,""):showDialog(0,c,"",d)}catch(e){showDialog(0,c,"",d)}return!1}function onUserLogin(a){showModalLogin()}function onUserLogout(a){$.post("/aj_user/logout",{},function(a){window.location.reload(!0)})}function initMenu(){$(".menu").hover(function(){$(this).children(".menuitem").show(),$(this).find(".menuitem").length&&$(this).addClass("hover")},function(){$(this).children(".menuitem").hide(),$(this).removeClass("hover")})}function initHeaderDaily(){function a(){var e=parseInt(b.css("top"));if(c.css("top","30px"),b.animate({top:e-30+"px"},"slow"),Math.abs(e)==d-30){c.animate({top:"0px"},"slow");var f=b;b=c,c=f}setTimeout(a,3e3)}var b=$("#daily_ul"),c=$("#daily_swap");if(b.length){c.html(b.html());var d=30*b.children("li").length;setTimeout(a,3e3)}}function initCountDownTime(){window.setInterval(function(){var a=(new Date).getTime();$(".dtime").each(function(){var b=$(this).attr("dtime");if(/^\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}$/.test(b)){var c=new Date(b).getTime();isNaN(c)&&(c=new Date(b.replace(/-/g,"/")).getTime()),$(this).attr("dtime",c)}else if(/^\d{10}$/.test(b)){var c=1e3*parseInt(b);$(this).attr("dtime",c)}else/^\d{13}$/.test(b)&&(c=b);b=c;var b=parseInt(b);(!b||isNaN(b))&&(b=0);var d=$(this).attr("pre")||"";$(this).text(d+mclib.getDTime(b,a))})},1e3)}function updateTopBarUser(a){isLogin=1,userId=a.userId,userName=a.userName||a.userMobile,userMobile=a.userMobile;var b=$("div.header div.toolbar_wrap div.toolbar ul.toolbar_user"),c='<li class="sep">|</li>',d='<li class="rightpadding10"><a class="leftpadding10 user_name" href="/user/" target="_blank"><img class="normal" src="/img/icon_common_topbar_login_0.png" /><img class="hover" src="/img/icon_common_topbar_login_1.png" />'+userName+'</a><span class="pointer user_logout" id="user_logout">[退出]</span></li>',e='<li class="leftpadding10 rightpadding10"><a class="user_name" href="/order/list" target="_blank">我的订单</a></li>',f='<li class="leftpadding10 rightpadding10 toolbar_user_mywrap menu"><span><a href="/user/" target="_blank">我的秒车</a></span><img class="normal" src="/img/icon_common_topbar_focus_0.png" /><img class="hover" src="/img/icon_common_topbar_focus_1.png" /><ul class="toolbar_user_my menuitem"><li><span><a href="/tuan/list" target="_blank">我的团购</a></span></li><li><span><a href="/focus/list" target="_blank">降价通知</a></span></li><li><span><a href="/quote/list" target="_blank">报价单</a></span></li><li><span><a href="/record/list" target="_blank">浏览记录</a></span></li><li><span><a href="/coupon/list" target="_blank">我的红包</a></span></li></ul></li>',g='<li class="leftpadding10 rightpadding10 toolbar_user_mywrap menu"><span><a href="/message/list" target="_blank">消息中心</a></span><img class="normal" src="/img/icon_common_topbar_focus_0.png" /><img class="hover" src="/img/icon_common_topbar_focus_1.png" /><ul class="toolbar_user_my menuitem"><li><span><a href="/message/list?t=1" target="_blank">系统通知</a></span></li><li><span><a href="/message/list?t=2" target="_blank">活动通知</a></span></li></ul></li>',h=b.children("li.user_login");h.after($(d+c+e+c+f+c+g)),h.remove(),initMenu(),initTopBar()}function initSearchBox(){if(0!=$("#js-search-txt").length){for(var a={historyList:[],keyList:[]},b=0;b<sugguest_default_data.length;b++){var c=sugguest_default_data[b],d=c.id||b,e=mclib.htmlSpecialChars(c.name)||"",f=parseFloat(c.discount);isNaN(f)&&(f=0),f=f>9.5||0>=f?"":f.toFixed(1)+"折起";var g=c.url||"",h={id:d,carName:e,discount:f,url:g};1==c.history?a.historyList.push(h):a.keyList.push(h)}$("#js-search-txt").search({buttonSearchID:"js-btn-search",dataPath:{get:"/aj_search/suggest"},delayTime:500,defaultData:a,areaId:epath_area.id,deleteCallback:function(a){for(var b=a.key,c="SearchHistory",d=mclib.cookie(c),e=JSON.parse(d),f=0;f<e.length;f++)if(b==e[f]){e.splice(f,1);break}d=JSON.stringify(e),mclib.cookie(c,d,{path:"/",domain:function(){var a=document.domain;return a.replace(a.split(".")[0],"")}(),expires:365})},searchCallback:function(a){var b=a.url;if(!b||"undefined"!=b){var c=$.trim(a.key);if(!c)return;c=c.substring(0,40),b=search_base_url+"?kw="+encodeURIComponent(c)}b&&(sendStat("click","is_search_query"),window.location.href=b)}})}}function initJSPagination(){function a(b,c,d,e,f,g){b=parseInt(b),c=parseInt(c),d=parseInt(d);var h="#"+f+" ."+g;e.empty();var i='<em p="1">&lt;&lt;</em>',j='<em p="'+(b-1)+'">'+(b-1)+"</em>",k='<em p="'+b+'" class="selected">'+b+"</em>",l='<em p="'+(b+1)+'">'+(b+1)+"</em>",m='<em p="'+c+'">&gt;&gt;</em>',n="";0==c||(n=1==c?k:1==b?k+l+m:b==c?i+j+k:i+j+k+l+m),e.append($(n)),$(h).each(function(a,c){c=$(c);var e=c.index();Math.floor(e/d)+1==b?c.show():c.hide()}),e.children("em").on("click",function(b){var h=$(this);h.hasClass("selected")||a(h.attr("p"),c,d,e,f,g)})}$(".js_pagination_con").each(function(b,c){c=$(c);var d=parseInt(c.attr("perpage")),e=c.attr("wrap"),f=c.attr("selector"),g="#"+e+" ."+f,h=$(g).length;if(!(d>=h)){var i=Math.ceil(h/d);a(1,i,d,c,e,f)}})}$(document).ready(onDOMReady);var sidepanel,onsalenotifysubmit,onsalenotifycancel,modallogin,dialog,masklayer,brandAlphaScrollbar,seriesScrollbar;