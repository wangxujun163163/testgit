!function(a){var b='<div class="onsalenotify_overlay_wrap" id="onsalenotify_overlay_wrap">   <img class="close" id="onsalenotify_closebtn" src="/img/tuan/tuan_index_icon_close_pop.png" />   <div class="tabcon">       <span class="tab_item selected" type="pw">账号密码登录</span><span class="tab_item" type="code">手机动态密码登录</span>   </div>   <div class="cntcon">       <div class="form_control">           <input class="mobile" placeholder="请输入手机号" id="onsalenotify_mobile">       </div>       <div class="form_control" id="captcha_wrap">           <input class="captcha" placeholder="请输入校验码" id="onsalenotify_captcha"><img class="captcha_img" id="onsalenotify_captcha_img" src="/user/captcha" /><span class="captcha_update" id="onsalenotify_captcha_update">换一张</span>       </div>       <div class="form_control" id="code_wrap">           <input class="code" placeholder="请输入验证码" id="onsalenotify_code"><span class="codebtn gray" id="onsalenotify_codebtn">发送验证码</span>       </div>       <p class="note agreement" id="agreement_wrap">           <input class="checkboxinput" type="checkbox" name="modalloginagreement" id="modalloginagreement" checked>           <label class="checkboxlabel" for="modalloginagreement">我已认真阅读并同意《 <a href="/help/agreement" target="_blank">村长团车用户服务协议</a> 》</label>       </p>       <div class="form_control" id="pw_wrap">           <input class="mobile" placeholder="请输入密码" id="onsalenotify_pw" type="password">       </div>       <p class="note nopw" id="nopw_wrap">           <input class="checkboxinput" type="checkbox" name="autologin" id="autologin" checked>           <label class="checkboxlabel" for="autologin">自动登录</label>           <a href="/user/findpwd" target="_blank">忘记密码</a>       </p>       <p class="failtips"></p>       <span class="btn long red" id="onsalenotify_submitbtn">登录</span>       <p class="note register" id="register_wrap">还没有村长团车账号？<a href="/user/reg" target="_blank">立即注册</a></p>   </div></div>';a.widget("miaoche.modallogin",{_init:function(){var c=this,d=c.options,e=c.element;a("div.onsalenotify_overlay_wrap",e).length||(e.append(b),d.modaltitle&&a("#onsalenotify_overlay_wrap .close").after(a('<p class="modaltitle">'+d.modaltitle+"</p>")),a("#onsalenotify_overlay_wrap .close").click(a.proxy(c.close,c)),d.type=d.type||"pw",c.switchLoginType(d.type),a("#onsalenotify_overlay_wrap .tab_item").on("click",function(){var b=a(this);b.hasClass("selected")||c.switchLoginType(b.attr("type"))}),d.extmobile&&a("#onsalenotify_mobile").val(d.extmobile),a("#onsalenotify_mobile").focusin(function(b){a("#onsalenotify_mobile").parent().removeClass("err")}),a("#onsalenotify_mobile").focusout(function(b){var c=a.trim(a("#onsalenotify_mobile").val());c&&/^1\d{10}$/.test(c)||a("#onsalenotify_mobile").parent().addClass("err")}),a("#onsalenotify_mobile").on("input propertychange",function(){var b=a.trim(a("#onsalenotify_mobile").val()),c=a.trim(a("#onsalenotify_captcha").val());b&&/^1\d{10}$/.test(b)&&c&&/^[0-9a-zA-Z]{4}$/.test(c)?a("#onsalenotify_codebtn").removeClass("gray"):a("#onsalenotify_codebtn").addClass("gray")}),a("#onsalenotify_pw").focusin(function(b){a("#onsalenotify_pw").parent().removeClass("err")}),a("#onsalenotify_pw").focusout(function(b){var c=a.trim(a("#onsalenotify_pw").val());c&&/^[^\s]{6,14}$/.test(c)||a("#onsalenotify_pw").parent().addClass("err")}),a("#onsalenotify_captcha").focusin(function(b){a("#onsalenotify_captcha").parent().removeClass("err")}),a("#onsalenotify_captcha").focusout(function(b){var c=a.trim(a("#onsalenotify_captcha").val());c&&/^[0-9a-zA-Z]{4}$/.test(c)||a("#onsalenotify_captcha").parent().addClass("err")}),a("#onsalenotify_captcha").on("input propertychange",function(){var b=a.trim(a("#onsalenotify_mobile").val()),c=a.trim(a("#onsalenotify_captcha").val());b&&/^1\d{10}$/.test(b)&&c&&/^[0-9a-zA-Z]{4}$/.test(c)?a("#onsalenotify_codebtn").removeClass("gray"):a("#onsalenotify_codebtn").addClass("gray")}),a("#onsalenotify_captcha_update").on("click",function(b){a("#onsalenotify_captcha_img").attr("src","/user/captcha?rt="+(new Date).getTime())}),a("#onsalenotify_captcha_img").attr("src","/user/captcha?rt="+(new Date).getTime()),a("#onsalenotify_codebtn").on("click",function(b){if(!a("#onsalenotify_codebtn").hasClass("gray")){a("#onsalenotify_mobile").parent().removeClass("err"),a("#onsalenotify_pw").parent().removeClass("err"),a("#onsalenotify_captcha").parent().removeClass("err"),a("#onsalenotify_code").parent().removeClass("err");var d=a.trim(a("#onsalenotify_mobile").val()),e=a.trim(a("#onsalenotify_captcha").val());if(!d||!/^1\d{10}$/.test(d))return void a("#onsalenotify_mobile").parent().addClass("err");if(!e||!/^[0-9a-zA-Z]{4}$/.test(e))return void a("#onsalenotify_captcha").parent().addClass("err");var f=a("#onsalenotify_codebtn"),g=c.disableCodeBtn(f),h={mobile:d,captcha:e};a.ajax({url:"/aj_user/sendverify",data:h,dataType:"json",type:"POST",success:function(a){a&&0==a.code||(c.showTips(a.desc||"手机号或校验码错误"),c.resetCodeBtn(g,f))},error:function(a){c.showTips(a.desc||"手机号或校验码错误"),c.resetCodeBtn(g,f)}}),mclib.cookie("VerifyCodeTimeStamp",(new Date).getTime(),{path:"/",domain:function(){var a=document.domain;return a.replace(a.split(".")[0],"")}(),expires:365})}}),a("#onsalenotify_code").focusin(function(b){a("#onsalenotify_code").parent().removeClass("err")}),a("#onsalenotify_code").focusout(function(b){var c=a.trim(a("#onsalenotify_code").val());return c&&/^\d{6}$/.test(c)?void 0:void a("#onsalenotify_code").parent().addClass("err")}),a("#onsalenotify_submitbtn").click(a.proxy(c.onCompleteBtnClick,c)))},destroy:function(){this.element.find("div.onsalenotify_overlay_wrap").remove()},close:function(){this._trigger("close",null,null)},succ:function(a){this._trigger("succ",null,a)},onCompleteBtnClick:function(b){var c=this,d={},e="",f=a.trim(a("#onsalenotify_mobile").val());if(!f||!/^1\d{10}$/.test(f))return void a("#onsalenotify_mobile").parent().addClass("err");if(d.mobile=f,"pw"==c.options.type){e="/aj_user/login";var g=a.trim(a("#onsalenotify_pw").val());if(!g||!/^[^\s]{6,14}$/.test(g))return void a("#onsalenotify_pw").parent().addClass("err");d.password=g,d.type=a("#autologin")[0].checked?1:0;var h=parseInt(mclib.cookie("VerifyCodeTimeStamp"));isNaN(h)&&(h=0);var i=(new Date).getTime();if(6e4>=i-h)return void c.showTips("校验短信刚刚发送过，请稍等1分钟再继续尝试",!0)}else{e="/aj_user/mobilelogin";var j=a.trim(a("#onsalenotify_code").val());if(!j||!/^\d{6}$/.test(j))return void a("#onsalenotify_code").parent().addClass("err");d.code=j;var k=a("#modalloginagreement")[0].checked;if(!k)return void c.showTips("请认真阅读并同意《 村长团车用户服务协议 》")}a("#onsalenotify_mobile").parent().removeClass("err"),a("#onsalenotify_pw").parent().removeClass("err"),a("#onsalenotify_captcha").parent().removeClass("err"),a("#onsalenotify_code").parent().removeClass("err"),a.ajax({url:e,data:d,dataType:"json",type:"POST",success:function(a){return a&&0==a.code?(sendStat("result","is_login_result","mobile="+a.content.userMobile),void c.succ(a)):void c.showTips(a.desc||"登录失败，请重试")},error:function(a){c.showTips("登录失败，请重试")}})},switchLoginType:function(b){b||(b="pw"),"pw"==b?(a("#onsalenotify_overlay_wrap #captcha_wrap").hide(),a("#onsalenotify_overlay_wrap #code_wrap").hide(),a("#onsalenotify_overlay_wrap #agreement_wrap").hide(),a("#onsalenotify_overlay_wrap #pw_wrap").show(),a("#onsalenotify_overlay_wrap #nopw_wrap").show(),a("#onsalenotify_overlay_wrap #register_wrap").show()):(a("#onsalenotify_overlay_wrap #captcha_wrap").show(),a("#onsalenotify_overlay_wrap #code_wrap").show(),a("#onsalenotify_overlay_wrap #agreement_wrap").show(),a("#onsalenotify_overlay_wrap #pw_wrap").hide(),a("#onsalenotify_overlay_wrap #nopw_wrap").hide(),a("#onsalenotify_overlay_wrap #register_wrap").hide()),a("#onsalenotify_overlay_wrap .tab_item").removeClass("selected"),a("#onsalenotify_overlay_wrap .tab_item[type="+b+"]").addClass("selected"),this.options.type=b},showTips:function(b,c){var d=a(".failtips");d.show().text(b||"登录失败，请重试"),c||window.setTimeout(function(){d.hide().text()},3e3)},disableCodeBtn:function(a){var b=this;a.addClass("gray");var c=60;a.text("正在发送..."+c+"秒"),c--;var d=window.setInterval(function(){a.text("正在发送..."+c+"秒"),c--,2==c&&b.resetCodeBtn(d,a)},1e3);return d},resetCodeBtn:function(a,b){window.setTimeout(function(){window.clearInterval(a),b.removeClass("gray"),b.text("获取动态密码"),mclib.cookie("VerifyCodeTimeStamp",0,{path:"/",domain:function(){var a=document.domain;return a.replace(a.split(".")[0],"")}(),expires:365})},2e3)}})}(jQuery);